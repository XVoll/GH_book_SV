[
["explo.html", "Section 4 Data exploration 4.1 Outcome variabes: distribution and outliers 4.2 Correlations and collinearity", " Section 4 Data exploration Data exploration can be broadly separated into two steps, exploration of: the outcome variables, i.e. the three development indicators we intend the map (income, poverty and literacy) the covariates, i.e. the set of predictors derived in Section 3. When exploring the outcome data, the aims is to identify possible issues such as lack of variation and the presence of outliers. It helps also specifying the likelihood function for the outcome data (e.g. Gaussian, Gamma, Beta, etc). The exploration of the covariates allows for the identification of possible multi-collineratiy issues, for reducing the set of candidate covariates as well as to get a better understanding of the relationship between the outcome variable of interest and the set of covariates. 4.1 Outcome variabes: distribution and outliers 4.1.1 Income We start by exploring the median income per segmento namedingpe in the data: Figure 4.1: Median income per segmento As it is common with incomes’ distribution, the distribution is right skewed: most segmentos have a median income between 95 and 105 USD and a few of them have a median income above 200 usd. Let us map income to explore possible spatial dependencies. Figure 4.2: Median income map Figure 4.2 suggests a core-periphery, where urban areas have higher income than rural ones. Furthermore, all the segmentos with a median income above 265 USD (blue markers) are clustered together in urban centers while the four ones with a income above 700 USD (gold markers) are located in Antiguo Cuscatlan, the most urbanized municipality in the country (Wikipedia). DIGESTYC provides a classification of segmentos into rural and urban one. The following graphs compare the distribution of income between rural and urban segmentos. Figure 4.3: Rural urban median income distributiuon The box plot on fig 4.3 shows that 3 quarters of the rural segmentos have a median income lower than three quarters of the urban segmentos1. The histogram shows that rural and urban segmentos appear to have clearly two separate income distributions and that a logarithmic transformation appears successful at making the distribution normal. An option is hence to log-transform the data and specify a a gaussian likelhood. Another option, the preferred one, is to model income with a gamma likelihood function which takes into account the assymetry in the distribution. 4.1.2 Literacy The variable literacy_rate provide the proportion of survey participants 16 years or older in each segmento who can read and write. Its domain is hence limited on 0 to 1. There is a clear spike at 100%: in 185 segmento, i.e. 11% of the segmento for which we have EHPM data, all participants aged 16 years and older can read. This spike of zero suggest that one could model literacy as a two step random process: first one model the presence/absence of illiteracy, and then we model proportion of respondent who are illiterate for segmentos where there is some illiteracy. As in the case of income, rural areas appears to have lower level of litracy than urban ones. 4.2 Correlations and collinearity Let us start exploring the relationship between the set of predictors and the outcome variables. This can be summarized in three steps: To standardized the variable; To compute the correlation between all pairs of variables To select the predictors the most correlated with the outcome variable To identify set of predictors which can be summarized. Correlation is measured with the distance correlation. The advantage over standard pearson correlation is to allow to take better into account non-linearity in the relationship between two variables. 4.2.1 Standardize the variables We start by standardizing the variables in order to limit the effects of outliers and of the different units in which the predictors are expressed. We also remove outliers in terms of incomes as they could affect spuriously the correlation. # add the survey data to shapefile segmento_sh_data=segmento_sh segmento_sh_data@data=segmento_sh_data@data%&gt;% dplyr::select(SEG_ID)%&gt;% mutate(SEG_ID=as.character(SEG_ID))%&gt;% left_join(ehpm17_predictors, by=&quot;SEG_ID&quot;) # identify outliers #### segmento_sh_data_model=segmento_sh_data non_na_index=which(is.na(segmento_sh_data_model$n_obs)==F) ehpm17_predictors_nona=segmento_sh_data_model@data[non_na_index,] ehpm17_predictors_nona=ehpm17_predictors_nona%&gt;% mutate(outliers=ifelse(ingpe&gt;quantile(ingpe,0.99,na.rm=T),&quot;high&quot;,&quot;no&quot;)) ehpm17_predictors_nona_noout=ehpm17_predictors_nona%&gt;% filter(outliers==&quot;no&quot;) covariates=ehpm17_predictors_nona_noout%&gt;% select(-c(ingpe,SEG_ID,municauto,n_obs,pobreza_extrema,pobreza_mod,literacy_rate, DEPTO,COD_DEP,MPIO,COD_MUN,CANTON,COD_CAN,COD_ZON_CE,COD_SEC_CE,COD_SEG_CE)) covariates=covariates %&gt;% mutate_if(is.character,as.factor) adj &lt;- caret::preProcess(covariates, method = c(&quot;center&quot;, &quot;scale&quot;), cutoff = .75, verbose = TRUE) ## Calculating 77 means for centering ## Calculating 77 standard deviations for scaling covariates_d &lt;- predict(adj, covariates) covariates_df=data.frame(ingpe=ehpm17_predictors_nona_noout$ingpe, literacy_rate=ehpm17_predictors_nona_noout$literacy_rate, pobreza_mod=ehpm17_predictors_nona_noout$pobreza_mod, covariates_d) 4.2.2 Correlation with income We then compute the distance correlation for all covariates with a loop and store these correlations in a dataframe. corr_re=list() names_re=list() for(i in 2:dim(covariates_d)[2]){ if(is.numeric(covariates_df[,i])){ non_na=complete.cases(covariates_df[,i]) cor_test=energy::dcor(covariates_df$ingpe[non_na],covariates_df[non_na,i]) corr_re[[i]]=c(cor_test) names_re[[i]]=names(covariates_df)[i] } } corr_df=do.call(rbind,corr_re) names_df=do.call(rbind,names_re) corr_df=as.data.frame(corr_df) corr_df$covariate=names_df names(corr_df)[1]=&quot;cor&quot; corr_df=corr_df%&gt;% arrange(desc(abs(cor))) Lastly we select only the variables with an absolute distance correlation with income higher than 20% and we plot the correlation with income. corr_df_top=corr_df%&gt;% filter(!(covariate%in%c(&quot;pobreza_mod&quot;,&quot;literacy_rate&quot;,&quot;ingpe&quot;)))%&gt;% filter(abs(cor)&gt;=.2) corr_df_top$covariate_f=factor(corr_df_top$covariate, levels = corr_df_top$covariate) plot_ly(x=corr_df_top$covariate_f, y=corr_df_top$cor, type=&quot;bar&quot;, name = corr_df_top$covariate)%&gt;% layout(title=&quot;Covariates correlations with Income&quot;, yaxis=list(tickformat = &quot;%&quot;)) As expected, the 4 most important covariates are those indicative urban centres: light at night intensity and standard deviation, share of of the segmento area with settlement and share of of the segmento area classified as urban in the ESA land cover map. The 2017 median NDVI comes in the 5th position: it could either reflect the importance of an healthy agriculture to higher income, or, more likely, is an artefact of the data: rooftops in urban areas yield specific NDVI value. The next ones are all covariates on distance to services and business: we can expect that more remote is an area, poorer it is. In order to test if the same set of covariates perform similarly in rural and urban segmentos, we replicate the investigation on rural and urban segmentos using the classification provided by DIGESTYC (code not shown). ## Calculating 77 means for centering ## Calculating 77 standard deviations for scaling ## Calculating 77 means for centering ## Calculating 77 standard deviations for scaling Let us know check if some top covariates for the rural and urban segmentos don’t show up when considering the entire sample as above. # Is any important predictor at the rural level not captured when considering the entire sample? any(!(corr_df_top_rural$covariate%in%corr_df_top$covariate)) ## [1] FALSE # Is any important predictor at the urban level not captured when considering the entire sample? any(!(corr_df_top_urban$covariate%in%corr_df_top$covariate)) ## [1] TRUE There is one top covariates for the urban segmentos which is not captured when considering the whole sample. This is: corr_df_top_urban[which(!(corr_df_top_urban$covariate%in%corr_df_top$covariate)),] ## cor covariate ## 20 0.261206 lc_crop The covariates lc_crop, correlated at 26% with income when focusing on urban areas, does not show up whe n considering all segentos. We add it hence in the candidate covariates. cov_candidates=c(corr_df_top$covariate,&quot;lc_crop&quot;) There are now 40 covariates. They are listed below. length(cov_candidates) ## [1] 40 cov_candidates ## [1] &quot;lights_med&quot; &quot;lights_sd&quot; &quot;settlements&quot; ## [4] &quot;lc_urban&quot; &quot;ndvi_17_median&quot; &quot;dist2urban_r&quot; ## [7] &quot;ndvi_17_sum&quot; &quot;dist2allpubserv&quot; &quot;dist2schools&quot; ## [10] &quot;dist2schools_priv&quot; &quot;dist2roadInter&quot; &quot;Shape_Area&quot; ## [13] &quot;dist2biz&quot; &quot;lc_tree&quot; &quot;dist2schools_pub&quot; ## [16] &quot;dist2pubamen&quot; &quot;dist2fin&quot; &quot;ndvi_17_sd&quot; ## [19] &quot;dist2road&quot; &quot;dist2health&quot; &quot;gpw_es_TOT&quot; ## [22] &quot;gpw_es_avg_dens&quot; &quot;pop_dens&quot; &quot;dist2hosp&quot; ## [25] &quot;soil_deg_SDG_index&quot; &quot;dist2tree_r&quot; &quot;slope&quot; ## [28] &quot;dens_residential&quot; &quot;dens_all_roads&quot; &quot;people_sch&quot; ## [31] &quot;dens_urban_no_motor&quot; &quot;dens_tertiary&quot; &quot;soil_prod_state&quot; ## [34] &quot;soil_luc&quot; &quot;soil_carb&quot; &quot;soil_prod_trj&quot; ## [37] &quot;dist2crop_r&quot; &quot;dens_secondary&quot; &quot;ndvi_17_perc_median&quot; ## [40] &quot;lc_crop&quot; In order to reduce the colinearity between covariates, for each family of covariates (e.g lights_med and lights_sd), we select only the member with the highest corelation with income. For instance, for lights_med and lights_sd, we select only lights_med. The reduced list of 18 covariates is given below: cov_candidates_selected=c(&quot;lights_med&quot;,&quot;settlements&quot;,&quot;lc_urban&quot;,&quot;ndvi_17_median&quot;,&quot;dist2urban_r&quot;,&quot;ndvi_17_sum&quot;,&quot;dist2allpubserv&quot;, &quot;dist2roadInter&quot;,&quot;Shape_Area&quot;,&quot;dist2biz&quot;,&quot;lc_tree&quot;,&quot;gpw_es_TOT&quot;,&quot;soil_deg_SDG_index&quot;,&quot;dist2tree_r&quot;, &quot;slope&quot;,&quot;dens_all_roads&quot;,&quot;dist2crop_r&quot;,&quot;lc_crop&quot;) cov_candidates_selected_df=data.frame(&quot;var_income&quot;=cov_candidates_selected) We write the selected predictors to a file. We will for use in fitting the model. write.table(cov_candidates_selected_df, paste0(dir_data, &quot;out/distance_corr_var/income.txt&quot;), row.names = F) In order to get a sense of the direction of the correlation and the associations between the variables, we plot a correlogram. corr_df_top_selected=corr_df_top%&gt;% bind_rows(corr_df_top_urban%&gt;% filter(covariate==&quot;lc_crop&quot;))%&gt;% filter(covariate %in%cov_candidates_selected)%&gt;% arrange(desc(abs(cor))) data_cor=covariates_df[,c(&quot;ingpe&quot;,c(corr_df_top_selected$covariate))] corrplot::corrplot(cor(data_cor, use=&quot;na.or.complete&quot;), main=&quot;Correlations: Income and predictors&quot;) qgraph::qgraph(cor(data_cor, use=&quot;na.or.complete&quot;), minimum=0.20, layout=&quot;spring&quot;, # groups=gr, labels=names(data_cor), label.scale=F, title=&quot;Correlations: Income and predictors&quot;) Both plots show clearly that the top predictors are highly correlated. The risk is hence to run into multi-collinearity issues if we were to fit the model with all these predictors. We will hence reduce this set of candidate covariates to a much smaller subset, less than 10 covariates are likely to be enough. 4.2.3 Correlation with literacy The process described above is repeated for literacy. Light a night comes again as the best predictor of literacy, followed by distance to urban areas and other indicators of how urban an area is. Interestingly, distance to public services comes before distance to school, however both the difference in their correlation with literacy is not statistically significant and distance to public services include the distance to schools. As before, we check if some top covariates for the rural and urban segmentos don’t show up when considering the entire sample, we reduce the final set of 24 candidate predictors by dropping covariates from the same family and save the selected covariates list for latter use in model fitting (code not shown). We can again look at the cross correlations. the third quartile of the rural segmentos’ distribution is lower than the first quartile of the urban segmentos↩ "]
]
